{"Event": {"timestamp": "1632573540", "threat_level_id": "2", "published": true, "date": "2021-09-25", "uuid": "fc8f98a6-daa5-42ef-b6f3-2db535c43c57", "publish_timestamp": "1632573647", "analysis": "2", "info": "MeteorExpress | Mysterious Wiper Paralyzes Iranian Trains with Epic Troll", "Orgc": {"uuid": "019e8d5f-83da-4d59-982d-e94cdcc7dbc7", "name": "ICS-CSIRT.io"}, "Tag": [{"colour": "#0088cc", "exportable": true, "name": "misp-galaxy:mitre-attack-pattern=\"Group Policy Modification - T1484.001\""}, {"colour": "#0088cc", "exportable": true, "name": "misp-galaxy:mitre-attack-pattern=\"Clear Windows Event Logs - T1070.001\""}, {"colour": "#00d622", "exportable": true, "name": "tlp:white"}, {"colour": "#e70e00", "exportable": true, "name": "dhs-ciip-sectors:DHS-critical-sectors=\"transport\""}], "Attribute": [{"timestamp": "1632571872", "comment": "", "category": "External analysis", "value": "https://www.sentinelone.com/labs/meteorexpress-mysterious-wiper-paralyzes-iranian-trains-with-epic-troll/", "type": "link", "uuid": "34736278-1e41-422e-a9d5-d9347a6327e1", "to_ids": false, "object_relation": null}, {"timestamp": "1632571872", "comment": "", "category": "External analysis", "value": "https://offensivecyber.org/2021/09/23/balancing-on-the-rail/", "type": "link", "uuid": "58f15744-1bb4-482a-9cb8-4ef0ba282dfc", "to_ids": false, "object_relation": null}, {"timestamp": "1632571958", "comment": "number for the office of Supreme Leader Ali Khamenei", "category": "Other", "value": "64411", "type": "comment", "uuid": "70f85e8c-7d09-4d55-a19b-08a8ae8dcf5e", "to_ids": false, "object_relation": null}, {"timestamp": "1632572113", "comment": "password for RAR archives", "category": "Other", "value": "hackemall", "type": "comment", "uuid": "d0cc3357-8584-4a31-98c4-a1213cba0a0f", "to_ids": false, "object_relation": null}, {"timestamp": "1632572723", "comment": "hardcoded \u00e2\u20ac\u02dclock_file\u00e2\u20ac\u2122", "category": "Persistence mechanism", "value": "C:WindowsTemp__lock6423900.dat", "type": "filename", "uuid": "d8a2bb2c-b7a5-4bd6-9921-3270a7df94e1", "to_ids": true, "object_relation": null}, {"timestamp": "1632573281", "comment": "execute the Meteor wiper at five minutes to midnight.", "category": "Artifacts dropped", "value": "mstask", "type": "windows-scheduled-task", "uuid": "008e3793-fdfb-44d1-887d-906c57445710", "to_ids": false, "object_relation": null}, {"timestamp": "1632573510", "comment": "", "category": "Payload delivery", "value": "import \"pe\"\r\n\r\nrule apt_ZZ_MeteorExpress_wiper_broad \r\n{\r\n\tmeta:\r\n\t\tdesc = \"Meteor wiper - broad hunting rule\"\r\n\t\tauthor = \"JAG-S @ SentinelLabs\"\r\n\t\tversion = \"1.0\"\r\n\t\tlast_modified = \"07.23.2021\"\r\n\t\thash = \"2aa6e42cb33ec3c132ffce425a92dfdb5e29d8ac112631aec068c8a78314d49b\"\r\n\tstrings:\r\n\t\t$meteor1 = \"Meteor is still alive.\" ascii wide\r\n\t\t$meteor2 = \"Meteor has finished. This shouldn't be possible because of the is-alive loop.\" ascii wide\r\n\t\t$meteor3 = \"Meteor has started.\" ascii wide\r\n\r\n\t\t$rtti1 = \".?AVBlackHoleException@@\" ascii wide\r\n\t\t$rtti2 = \".?AVWiperException@@\" ascii wide\r\n\t\t$rtti3 = \".?AVMiddleWiperException@@\" ascii wide\r\n\t\t$rtti4 = \".?AVCMDException@@\" ascii wide\r\n\t\t$rtti5 = \".?AVCouldNotFindNewWinlogonException@@\" ascii wide\r\n\t\t$rtti6 = \".?AVLockScreenException@@\" ascii wide\r\n\t\t$rtti7 = \".?AVScreenSaverException@@\" ascii wide\r\n\t\t$rtti8 = \".?AVFailedToIsolateFromDomainWinapiException@@\" ascii wide\r\n\t\t$rtti9 = \".?AVFailedToIsolateFromDomainWmiException@@\" ascii wide\r\n\t\t$rtti10 = \".?AVSettingPasswordException@@\" ascii wide\r\n\t\t$rtti11 = \".?AVPasswordChangerException@@\" ascii wide\r\n\t\t$rtti12 = \".?AVEnumeratingUsersException@@\" ascii wide\r\n\t\t$rtti13 = \".?AVProcessTerminationFailedException@@\" ascii wide\r\n\t\t$rtti14 = \".?AVProcessNotTerminatedException@@\" ascii wide\r\n\t\t$rtti15 = \".?AVFirstProcessWasNotFoundException@@\" ascii wide\r\n\t\t$rtti16 = \".?AVProcessSnapshotCreationFailedException@@\" ascii wide\r\n\t\t$rtti17 = \".?AVProcessTerminatorException@@\" ascii wide\r\n\t\t$rtti18 = \".?AVOpenProcessFailedException@@\" ascii wide\r\n\t\t$rtti19 = \".?AVFailedToLockException@@\" ascii wide\r\n\t\t$rtti20 = \".?AVLockerException@@\" ascii wide\r\n\t\t$rtti21 = \".?AVBCDException@@\" ascii wide\r\n\t\t$rtti22 = \".?AVCouldNotCreateProcessException@@\" ascii wide\r\n\t\t$rtti23 = \".?AVPipeNotCreatedCMDException@@\" ascii wide\r\n\r\n\t\t$config_keys1 = \"state_path\" ascii wide fullword\r\n\t\t$config_keys2 = \"log_encryption_key\" ascii wide fullword\r\n\t\t$config_keys3 = \"processes_to_kill\" ascii wide fullword\r\n\t\t$config_keys4 = \"process_termination_timeout\" ascii wide fullword\r\n\t\t$config_keys5 = \"log_server_port\" ascii wide fullword\r\n\t\t$config_keys6 = \"locker_background_image_jpg_path\" ascii wide fullword\r\n\t\t$config_keys7 = \"auto_logon_path\" ascii wide fullword\r\n\t\t$config_keys8 = \"locker_background_image_bmp_path\" ascii wide fullword\r\n\t\t$config_keys9 = \"state_encryption_key\" ascii wide fullword\r\n\t\t$config_keys10 = \"log_server_ip\" ascii wide fullword\r\n\t\t$config_keys11 = \"log_file_path\" ascii wide fullword\r\n\t\t$config_keys12 = \"paths_to_wipe\" ascii wide fullword\r\n\t\t$config_keys13 = \"wiping_stage_logger_interval\" ascii wide fullword\r\n\t\t$config_keys14 = \"locker_installer_path\" ascii wide fullword\r\n\t\t$config_keys15 = \"locker_exe_path\" ascii wide fullword\r\n\t\t$config_keys16 = \"locker_registry_settings_files\" ascii wide fullword\r\n\t\t$config_keys17 = \"locker_password_hash\" ascii wide fullword\r\n\t\t$config_keys18 = \"users_password\" ascii wide fullword\r\n\t\t$config_keys19 = \"cleanup_scheduled_task_name\" ascii wide fullword\r\n\t\t$config_keys20 = \"self_scheduled_task_name\" ascii wide fullword\r\n\t\t$config_keys21 = \"cleanup_script_path\" ascii wide fullword\r\n\t\t$config_keys22 = \"is_alive_loop_interval\" ascii wide fullword\t\t\r\n\r\n\t\t$failure1 = \"failed to initialize configuration from file %s\" ascii wide\r\n\t\t$failure2 = \"Failed to find base-64 data size. Error code: %s.\" ascii wide\r\n\t\t$failure3 = \"Failed to encode wide-character string as Base64. Error code: %s.\" ascii wide\r\n\t\t$failure4 = \"Failed to generate password of length %s. Generating a default one.\" ascii wide\r\n\t\t$failure5 = \"Failed creating scheduled task for system with name %s.\" ascii wide\r\n\t\t$failure6 = \"Failed to add a new administrator: %s.\" ascii wide\r\n\t\t$failure7 = \"Failed logging off session: %s\" ascii wide\r\n\t\t$failure8 = \"Failed creating scheduled task with name %s for user %s.\" ascii wide\r\n\t\t$failure9 = \"Failed to wipe file %s\" ascii wide\r\n\t\t$failure10 = \"Failed to create thread. Error message: %s\" ascii wide\r\n\t\t$failure11 = \"failed to get configuration value with key %s\" ascii wide\r\n\t\t$failure12 = \"failed to parse the configuration from file %s\" ascii wide\r\n\t\t$failure13 = \"Failed to create handle. Error code %s\" ascii wide\r\n\t\t$failure14 = \"failed to write message to log file %s\" ascii wide\r\n\t\t$failure15 = \"Getting new winlogon session failed. Attempts: %s/%s\" ascii wide\r\n\t\t$failure16 = \"Failed creating processes snapshot, process name: %s, error code %s.\" ascii wide\r\n\t\t$failure17 = \"Failed to query process info from snapshot. Process name: %s, error code: %s.\" ascii wide\r\n\t\t$failure18 = \"Failed to add new user %s. Error code %s.\" ascii wide\r\n\t\t$failure19 = \"Failed opening process, process name: %s, error code %s.\" ascii wide\r\n\t\t$failure20 = \"Failed to open the access token of a process. Error code: %s\" ascii wide\r\n\t\t$failure21 = \"Failed to enumerate local WTS. The error code: %s\" ascii wide\r\n\t\t$failure22 = \"Failed to duplicate the access token of a process. Error code: %s\" ascii wide\r\n\t\t$failure23 = \"Failed to query the session id of a given token. Error code: %s.\" ascii wide\r\n\t\t$failure24 = \"Failed to add user %s to group %s. Error code %s\" ascii wide\r\n\t\t$failure25 = \"Failed to set value for key %s. Error code: %s.\" ascii wide\r\n\t\t$failure26 = \"Failed to retrieve subkey of HKEY_USER. index is %s. error code %s.\" ascii wide\r\n\t\t$failure27 = \"Failed to disable rotating lock screen for user %s.\" ascii wide\r\n\t\t$failure28 = \"Failed to isolate from domain using wmi. Error code: %s.\" ascii wide\r\n\t\t$failure29 = \"Failed to isolate from domain using winapi. Error code %s\" ascii wide\r\n\t\t$failure30 = \"Failed while trying to wipe files: %s\" ascii wide\r\n\t\t$failure31 = \"Failed to change password for user %s. Error code %s.\" ascii wide\r\n\t\t$failure32 = \"Failed to get network info. Error code %s\" ascii wide\r\n\t\t$failure33 = \"Failed to open process. Pid: %s, error code: %s\" ascii wide\r\n\t\t$failure34 = \"Failed to terminate process. Pid: %s, error code: %s\" ascii wide\r\n\t\t$failure35 = \"Failed to create a snapshot of the running processes. Error code: %s.\" ascii wide\r\n\t\t$failure36 = \"Failed to delete locker lock screen, path %s\" ascii wide\r\n\t\t$failure37 = \"Failed to delete locker uninstaller from path %s\" ascii wide\r\n\t\t$failure38 = \"Failed to flush key %s: %s.\" ascii wide\r\n\t\t$failure39 = \"Gfailed to parse json from file %s\" ascii wide\r\n\t\t$failure40 = \"failed to read from json file %s\" ascii wide\r\n\t\t$failure41 = \"Failed to wait for a mutex. the return value was: %s.\" ascii wide\r\n\t\t$failure42 = \"Waiting for process failed. Error: %s\" ascii wide\r\n\t\t$failure43 = \"Failed to open key %s, with error %s.\" ascii wide\r\n\t\t$failure44 = \"Failed to query information of hkey %s.\" ascii wide\r\n\t\t$failure45 = \"Failed to get value for key %s. Failed with error code %s\" ascii wide\r\n\t\t$failure46 = \"Failed disabling wow 64 redirection mechanism. Error code %s\" ascii wide\r\n\t\t$failure47 = \"Failed getting  %s module. Error code %s\" ascii wide\r\n\t\t$failure48 = \"Failed retrieving method address, method name: %s. Error code %s\" ascii wide\r\n\t\t$failure49 = \"Failed to adjust access token privileges.\" ascii wide\r\n\t\t$failure50 = \"Failed to retrieve LUID for a privilege name in local system.\" ascii wide\r\n\t\t$failure51 = \"Failed to initiate reboot.\" ascii wide\r\n\t\t$failure52 = \"Failed to retrieve process token.\" ascii wide\r\n\t\t$failure53 = \"Failed to change lock screen in Windows XP.\" ascii wide\r\n\t\t$failure54 = \"Failed to register auto logon\" ascii wide\r\n\t\t$failure55 = \"Failed to change lock screen in Windows 7.\" ascii wide\r\n\t\t$failure56 = \"Failed to change lock screen in Windows 10.\" ascii wide\r\n\t\t$failure57 = \"PLocker failed\" ascii wide\r\n\t\t$failure58 = \"Failed to isolate from domain using wmi because command couldn't run\" ascii wide\r\n\t\t$failure59 = \"Failed to parse domain and username data.\" ascii wide\r\n\t\t$failure60 = \"Failed to run the locker\" ascii wide\r\n\t\t$failure61 = \"Failed to find default browser\" ascii wide\r\n\t\t$failure62 = \"Failed to install locker\" ascii wide\r\n\t\t$failure63 = \"Failed to terminate the locker process.\" ascii wide\r\n\t\t$failure64 = \"Failed to import locker settings\" ascii wide\r\n\t\t$failure65 = \"Failed to set locker settings.\" ascii wide\r\n\t\t$failure66 = \"Failed to lock\" ascii wide\r\n\t\t$failure67 = \"Failed to create mutex.\" ascii wide\r\n\t\t$failure68 = \"Supplier failed while iterating filter functions that check if a file is valid.\" ascii wide\r\n\t\t$failure69 = \"Supplier failed while filtering an existing target.\" ascii wide\r\n\t\t$failure70 = \"Supplier failed while filtering a potential target.\" ascii wide\r\n\t\t$failure72 = \"Wiper operation failed.\" ascii wide\r\n\t\t$failure73 = \"Screen saver disable failed.\" ascii wide\r\n\t\t$failure74 = \"Failed to delete boot configuration\" ascii wide\r\n\t\t$failure75 = \"Failed to change lock screen\" ascii wide\r\n\t\t$failure76 = \"Failed to kill all winlogon processes\" ascii wide\r\n\t\t$failure77 = \"Process terminator failed\" ascii wide\r\n\t\t$failure78 = \"Failed to change the passwords of all users\" ascii wide\r\n\t\t$failure79 = \"Failed to run the locker thread\" ascii wide\r\n\t\t$failure80 = \"Generating random password failed\" ascii wide\r\n\t\t$failure81 = \"Locker installation failed\" ascii wide\r\n\t\t$failure82 = \"Failed to set auto logon.\" ascii wide\r\n\t\t$failure83 = \"Failed to initialize interval logger. Using a dummy logger instead.\" ascii wide\r\n\t\t$failure84 = \"Failed disabling the first logon privacy settings user approval.\" ascii wide\r\n\t\t$failure85 = \"Failed disabling the first logon animation.\" ascii wide\r\n\t\t$failure86 = \"Failed to isolate from domain\" ascii wide\r\n\t\t$failure87 = \"Failed to get the new token of winlogon.\" ascii wide\r\n\t\t$failure88 = \"Failed adding new admin user.\" ascii wide\r\n\t\t$failure89 = \"Failed changing settings for the created new user.\" ascii wide\r\n\t\t$failure90 = \"Failed disabling recovery mode.\" ascii wide\r\n\t\t$failure91 = \"Failed to log off all sessions\" ascii wide\r\n\t\t$failure92 = \"Failed to delete shadowcopies.\" ascii wide\r\n\t\t$failure93 = \"Failed setting boot policy to ignore all errors.\" ascii wide\r\n\t\t$failure94 = \"Failed logging off all local sessions, except winlogon.\" ascii wide\r\n\r\n\t\t$log1 = \"Succeeded loggingoff session: %s\" ascii wide fullword\r\n\t\t$log2 = \"Logging off all local sessions, except winlogon.\" ascii wide fullword\r\n\t\t$log3 = \"Logging off all sessions.\" ascii wide fullword\r\n\t\t$log4 = \"Logging off users on Windows version 8 or above\" ascii wide fullword\r\n\t\t$log5 = \"Logging off users in Windows 7\" ascii wide fullword\r\n\t\t$log6 = \"Logging off users in Windows XP\" ascii wide fullword\r\n\t\t$log7 = \"End interval logger. Resuming writing every log.\" ascii wide fullword\r\n\t\t$log8 = \"Exiting main function because of some error\" ascii wide fullword\r\n\r\n\t\t$lockMyPC1 = \"C:\\\\Program Files\\\\Lock My PC 4\\\\unins000.exe\" ascii wide fullword\r\n\t\t$lockMyPC2 = \"SOFTWARE\\\\FSPro Labs\\\\Lock My PC 4\" ascii wide fullword\r\n\t\t$lockMyPC3 = \"C:\\\\Program Files\\\\Lock My PC 4\\\\LockScreens\\\\lockscreen2.jpg\" ascii wide fullword\r\n\t\t$lockMyPC4 = \"C:\\\\Program Files\\\\Lock My PC 4\\\\LockScreens\\\\lockscreen1.jpg\" ascii wide fullword\r\n\t\t$lockMyPC5 = \"C:\\\\Program Files\\\\Lock My PC 4\\\\LockScreens\\\\lockscreen4.jpg\" ascii wide fullword\r\n\t\t$lockMyPC6 = \"C:\\\\Program Files\\\\Lock My PC 4\\\\LockScreens\\\\lockscreen3.jpg\" ascii wide fullword\r\n\t\t$lockMyPC7 = \"C:\\\\Program Files\\\\Lock My PC 4\\\\LockScreens\\\\lockscreen6_r.gif\" ascii wide fullword\r\n\t\t$lockMyPC8 = \"C:\\\\Program Files\\\\Lock My PC 4\\\\LockScreens\\\\lockscreen5_b.gif\" ascii wide fullword\r\n\r\n\t\t$bcd1 = \"bcdedit.exe /set {default} recoveryenabled no\" ascii wide fullword\r\n\t\t$bcd2 = \"bcdedit.exe /set {default} bootstatuspolicy ignoreallfailures\" ascii wide fullword\r\n\t\t$bcd3 = \"sCould not delete BCD entry. Identifier: %s\" ascii wide fullword\r\n\t\t$bcd4 = \"Could not delete all BCD entries.\" ascii wide fullword\r\n\t\t$bcd5 = \"Finished deleting BCD entries.\" ascii wide fullword\r\n\t\t$bcd6 = \"Reached maximum number of BCD entry deletion attempts.\" ascii wide fullword\r\n\t\t$bcd7 = \"Could not get BCD entries.\" ascii wide fullword\r\n\t\t$bcd8 = \"bcd00000000\\\\objects\" ascii wide fullword\r\n\r\n\t\t$password1 = \"Changing passwords of all users to %s\" ascii wide fullword\r\n\t\t$password2 = \"Succeeded adding new user %s with password %s.\" ascii wide fullword\r\n\t\t$password3 = \"Changed the password of local user %s to %s.\" ascii wide fullword\r\n\t\t$password4 = \"The password's length is smaller than the complex prefix. Returning a fixed prefix.\" ascii wide fullword\r\n\r\n\t\t$boot1 = \"default=multi(0)disk(10000000)rdisk(0)partition(1000000)\\\\WINDOWS\" ascii wide\r\n\t\t$boot2 = \"multi(0)disk(10000000)rdisk(0)partition(1000000)\\\\WINDOWS=\\\"Microsoft Windows XP Professional\\\" /noexecute=optin /fastdetect\" ascii wide\r\n\r\n\t\t$success1 = \"Succeeded setting auto logon for %s.\" ascii wide fullword\r\n\t\t$success2 = \"Succeeded creating scheduled task for system with name %s.\" ascii wide fullword\r\n\t\t$success3 = \"Succeeded creating scheduled task with name %s for user %s.\" ascii wide fullword\r\n\t\t$success4 = \"Unsuccessful exit code returned from cmd: %s. Exit code: %s.\" ascii wide fullword\r\n\t\t$success5 = \"Succeeded adding new user %s to group %s.\" ascii wide fullword\r\n\t\t$success6 = \"Successfully disabled rotating lock screen saver of user %s.\" ascii wide fullword\r\n\t\t$success7 = \"Successfully removed %s from lock screen directory.\" ascii wide fullword\r\n\t\t$success8 = \"Terminated process successfully. process name: %s, pid: %s\" ascii wide fullword\r\n\t\t$success9 = \"Process created successfully. Executed command: %s.\" ascii wide fullword\r\n\t\t$success10 = \"Success restarting machine using cmd.\" ascii wide fullword\r\n\t\t$success11 = \"Successfully changed lock screen image in Windows 7\" ascii wide fullword\r\n\t\t$success12 = \"Successfully changed lock screen image in Windows 10\" ascii wide fullword\r\n\t\t$success13 = \"Successfully changed lock screen image in Windows XP\" ascii wide fullword\r\n\t\t$success14 = \"Unjoining domain using WMIC finished successfully\" ascii wide fullword\r\n\t\t$success15 = \"Unjoining domain using WINAPI finished successfully\" ascii wide fullword\r\n\t\t$success16 = \"Succeeded disabling the first logon animation.\" ascii wide fullword\r\n\t\t$success17 = \"Succeeded disabling the first logon privacy settings user approval.\" ascii wide fullword\r\n\t\t$success18 = \"Boot configuration deleted successfully\" ascii wide fullword\r\n\t\t$success19 = \"Screen saver disabled successfully.\" ascii wide fullword\r\n\t\t$success20 = \"Succeeded setting boot policy to ignore all errors.\" ascii wide fullword\r\n\t\t$success21 = \"Succeeded disabling recovery mode.\" ascii wide fullword\r\n\t\t$success22 = \"Successfully logged off all local sessions, except winlogon.\" ascii wide fullword\r\n\t\t$success23 = \"Succeeded deleting shadowcopies.\" ascii wide fullword\r\n\r\n\t\t$locker1 = \"Installing the locker from path %s\" ascii wide fullword\r\n\t\t$locker2 = \"Removing locker uninstaller from path %s\" ascii wide fullword\r\n\t\t$locker3 = \"Started changing lock screen image in Windows 7.\" ascii wide fullword\r\n\t\t$locker4 = \"Started changing lock screen image in Windows XP.\" ascii wide fullword\r\n\t\t$locker5 = \"Could not remove lock screen cache directory _P.\" ascii wide fullword\r\n\t\t$locker6 = \"Started changing lock screen image in Windows 10.\" ascii wide fullword\r\n\t\t$locker7 = \"Could not remove lock screen cache directory _Z.\" ascii wide fullword\r\n\t\t$locker8 = \"eUpdating locker settings\" ascii wide fullword\r\n\t\t$locker9 = \"The locker is not installed\" ascii wide fullword\r\n\t\t$locker10 = \"Running locker thread\" ascii wide fullword\r\n\r\n\t\t$attempt1 = \"attempted to access encrypted file in offset %s, but it only supports offset 0\" ascii wide\r\n\t\t$attempt2 = \"Attempting to restart machine using cmd in %s seconds\" ascii wide\r\n\t\t$attempt3 = \"Attempting to restart machine using winapi in %s seconds\" ascii wide\r\n\t\t$attempt4 = \"Attempted to restart asynchronously using cmd.\" ascii wide\r\n\t\t$attempt5 = \"Attempted to restart asynchronously using WINAPI.\" ascii wide\r\n\t\t$attempt6 = \"Restart attempted using cmd, while another restart is already initiated.\" ascii wide\r\n\t\t$attempt7 = \"Reached maximal attempts of getting a new winlogon token\" ascii wide\r\n\r\n\t\t$process1 = \"Process %s was not found.\" ascii wide fullword\r\n\t\t$process2 = \"Could not find snapshot's first process. Error code: %s\" ascii wide fullword\r\n\t\t$process3 = \"Process %s with pid %s was not terminated.\" ascii wide fullword\r\n\t\t$process4 = \"Process termination wait timed out. Error code: %s\" ascii wide fullword\r\n\t\t$process5 = \"Could not get process exit code. Error code: %s.\" ascii wide fullword\r\n\t\t$process6 = \"Process exit code is %s.\" ascii wide fullword\r\n\t\t$process7 = \"Could not create process. Command: %s, error code: %s.\" ascii wide fullword\r\n\t\t$process8 = \"Could not create impersonated process. Command: %s, error code: %s.\" ascii wide fullword\r\n\t\t$process9 = \"Encountered an error while terminating process with fatal priority. continuing\" ascii wide fullword\r\n\t\t$process10 = \"Process has finished.\" ascii wide fullword\r\n\t\t$process11 = \"Waiting for new winlogon process\" ascii wide fullword\r\n\t\t$process12 = \"Killing all winlogon processes\" ascii wide fullword\r\n\t\t\r\n\t\t$command1 = \"icacls.exe \\\"C:\\\\Windows\\\\Web\\\\Screen\\\" /grant System:(OI)(CI)F /T\" ascii wide\r\n\t\t$command2 = \"takeown.exe /F \\\"C:\\\\ProgramData\\\\Microsoft\\\\Windows\\\\SystemData\\\" /R /A /D Y\" ascii wide\r\n\t\t$command3 = \"icacls.exe \\\"C:\\\\ProgramData\\\\Microsoft\\\\Windows\\\\SystemData\\\" /grant Administrators:(OI)(CI)F /T\" ascii wide\r\n\t\t$command4 = \"icacls.exe \\\"C:\\\\ProgramData\\\\Microsoft\\\\Windows\\\\SystemData\\\" /grant System:(OI)(CI)F /T\" ascii wide\r\n\t\t$command5 = \"icacls.exe \\\"C:\\\\ProgramData\\\\Microsoft\\\\Windows\\\\SystemData\\\\S-1-5-18\\\\ReadOnly\\\" /reset /T\" ascii wide\r\n\t\t$command6 = \"icacls.exe \\\"C:\\\\Windows\\\\Web\\\\Screen\\\" /grant Administrators:(OI)(CI)F /T\" ascii wide\r\n\t\t$command7 = \"icacls.exe \\\"C:\\\\Windows\\\\Web\\\\Screen\\\" /reset /T\" ascii wide\r\n\t\t$command8 = \"wmic computersystem where name=\\\"%computername%\\\" call unjoindomainorworkgroup\" ascii wide\r\n\t\t$command9 = \"vssadmin.exe delete shadows /all /quiet\" ascii wide\r\n\t\t$command10 = \"shutdown.exe /r /f /t \" ascii wide\r\n\t\t$command11 = \"wbem\\\\wmic.exe shadowcopy delete\" ascii wide\r\n\t\t$command12 = \"takeown.exe /F \\\"C:\\\\Windows\\\\Web\\\\Screen\\\" /R /A /D Y\" ascii wide\r\n\r\n\t\t$formatStr1 = \"File %s is not readable.\" ascii wide fullword\r\n\t\t$formatStr2 = \"File %s is not writable.\" ascii wide fullword\r\n\t\t$formatStr3 = \"Could not open file %s. error message: %s\" ascii wide fullword\r\n\t\t$formatStr4 = \"Could not write to file %s. error message: %s\" ascii wide fullword\r\n\t\t$formatStr5 = \"tCould not tell file pointer location on file %s.\" ascii wide fullword\r\n\t\t$formatStr6 = \"Could not set file pointer location on file %s to offset %s.\" ascii wide fullword\r\n\t\t$formatStr7 = \"Could not read from file %s. error message: %s\" ascii wide fullword\r\n\t\t$formatStr8 = \"File %s does not exist\" ascii wide fullword\r\n\t\t$formatStr9 = \"Skipping %s logs. Writing log number %s: \" ascii wide fullword\r\n\t\t$formatStr10 = \"Start interval logger. Writing logs with an interval of %s logs.\" ascii wide fullword\r\n\t\t$formatStr11 = \"The log message is too big: %s/%s characters.\" ascii wide fullword\r\n\t\t$formatStr13 = \"Found local user: %s.\" ascii wide fullword\r\n\t\t$formatStr14 = \"Filesystem failure: %s\" ascii wide fullword\r\n\t\t$formatStr15 = \"Couldn't wipe file %s.\" ascii wide fullword\r\n\t\t$formatStr16 = \"Finished wiping file %s with %s.\" ascii wide fullword\r\n\t\t$formatStr17 = \"Started wiping file %s with %s.\" ascii wide fullword\r\n\t\t$formatStr18 = \"Failure while enumerating local users. Error code: %s.\" ascii wide fullword\r\n\t\t$formatStr19 = \"The browser %s is not supported\" ascii wide fullword\r\n\t\t$formatStr20 = \".json array size is %s, but should have been %s\" ascii wide fullword\r\n\t\t$formatStr21 = \"ejson uint value is not in range %s to %s.\" ascii wide fullword\r\n\t\t$formatStr22 = \"The path %s does not exist.\" ascii wide fullword\r\n\t\t$formatStr23 = \"A path in %s could not be accessed. Continuing...\" ascii wide fullword\r\n\t\t$formatStr24 = \"The directory path %s could not be iterated.\" ascii wide fullword\r\n\t\t$formatStr25 = \"Caught std::filesystem::filesystem_error: %s\" ascii wide fullword\r\n\t\t$formatStr26 = \"Line %d, Column %d\" ascii wide fullword\r\n\t\t$formatStr27 = \"Error from reader: %s\" ascii wide fullword\r\n\t\t$formatStr28 = \"%s %s HTTP/1.1\" ascii wide fullword\r\n\r\n\t\t$settings1 = \"unknown_hostname\" ascii wide fullword\r\n\t\t$settings2 = \"unknown_mac\" ascii wide fullword\r\n\t\t$settings3 = \"copy_file\" ascii wide fullword\r\n\t\t$settings4 = \"create_directories\" ascii wide fullword\r\n\r\n\t\t$couldnt1 = \"Could not change background image.\" ascii wide fullword\r\n\t\t$couldnt2 = \"Could not create stdout pipe.\" ascii wide fullword\r\n\t\t$couldnt3 = \"Could not set handle information for pipe.\" ascii wide fullword\r\n\t\t$couldnt4 = \"Could not hide current console.\" ascii wide fullword\r\n\t\t$couldnt5 = \"Could not get the window handle used by the console.\" ascii wide fullword\r\n\r\n\t\t$random1 = \"C:\\\\Windows\\\\Sysnative\\\\\" ascii wide fullword\r\n\t\t$random2 = \"C:\\\\Windows\\\\system32\\\\\" ascii wide fullword\r\n\t\t$random3 = \"MESSAGE_IN_QUEUE\" ascii wide fullword\r\n\t\t$random4 = \"Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/40.0.2214.93 Safari/537.36\" ascii wide fullword\r\n\t\t$random5 = \"cpp-httplib/0.2\" ascii wide fullword\r\n\t\r\n\tcondition:\r\n\t\tuint16(0) == 0x5a4d\r\n\t\tand\r\n\t\t(\r\n\t\t\tany of ($meteor*)\r\n\t\t\tor\r\n\t\t\t5 of ($rtti*)\r\n\t\t\tor\r\n\t\t\t5 of ($config_keys*)\r\n\t\t\tor\r\n\t\t\t10 of ($failure*)\r\n\t\t\tor\r\n\t\t\t2 of ($log*)\r\n\t\t\tor\r\n\t\t\tall of ($lockMyPC*)\r\n\t\t\tor\r\n\t\t\t4 of ($bcd*)\r\n\t\t\tor\r\n\t\t\t2 of ($password*)\r\n\t\t\tor\r\n\t\t\tany of ($boot*)\r\n\t\t\tor\r\n\t\t\t3 of ($success*)\r\n\t\t\tor\r\n\t\t\t3 of ($locker*)\r\n\t\t\tor\r\n\t\t\t2 of ($attempt*)\r\n\t\t\tor\r\n\t\t\t3 of ($process*)\r\n\t\t\tor\r\n\t\t\t3 of ($command*)\r\n\t\t\tor\r\n\t\t\t10 of ($formatStr*)\r\n\t\t\tor\r\n\t\t\tall of ($settings*)\r\n\t\t\tor\r\n\t\t\tall of ($couldnt*)\r\n\t\t\tor\r\n\t\t\tall of ($random*)\r\n\t\t)\r\n}\r\n\r\nrule apt_ZZ_MeteorExpress_locker\r\n{\r\n\tmeta:\r\n\t\tdesc = \"MeteorExpress ScreenLocker\"\r\n\t\tauthor = \"JAG-S @ SentinelLabs\"\r\n\t\tversion = \"1.0\"\r\n\t\tlast_modified = \"07.21.2021\"\r\n\t\thash = \"074bcc51b77d8e35b96ed444dc479b2878bf61bf7b07e4d7bd4cf136cc3c0dce\"\r\n\tstrings:\r\n\t\t$a1 = \"WindowClass\" ascii wide fullword\r\n\t\t$a2 = \"C:\\\\temp\\\\mscap.bmp\" ascii wide\r\n\t\t$a3 = \".?AVCreateWindowFailed@exceptions@@\" ascii wide\r\n\t\t$a4 = \".00cfg\" ascii wide fullword\r\n\tcondition:\r\n\t\tuint16(0) == 0x5a4d\r\n\t\tand\r\n\t\tall of them\r\n}", "type": "yara", "uuid": "820e79e9-0a6e-4f1b-8f28-8ebb9c09850e", "to_ids": false, "object_relation": null}], "Object": [{"timestamp": "1632572206", "comment": "", "meta-category": "file", "uuid": "42e3f8bc-0e8a-48b7-a62b-e63abcc25c3f", "sharing_group_id": "0", "template_uuid": "688c46fb-5edb-40a3-8273-1af7923e2215", "name": "file", "description": "File object describing a file with meta-information", "distribution": "5", "template_version": "24", "Attribute": [{"timestamp": "1632572206", "comment": "attacker supplied copy", "category": "Payload delivery", "value": "Rar.exe", "type": "filename", "uuid": "e344d9a1-47c5-4b38-b4f6-f69f57928c44", "to_ids": false, "object_relation": "filename"}]}, {"timestamp": "1632572319", "comment": "locks the system", "meta-category": "file", "uuid": "37e52629-ade4-41d6-b1bd-9e2688b9fab3", "sharing_group_id": "0", "template_uuid": "688c46fb-5edb-40a3-8273-1af7923e2215", "name": "file", "description": "File object describing a file with meta-information", "distribution": "5", "template_version": "24", "Attribute": [{"timestamp": "1632572319", "comment": "", "category": "Payload delivery", "value": "e55cee8b49f80e957b52976b2da6379e329466a3", "type": "sha1", "uuid": "414fac01-23dd-494c-932f-57437b2e54b8", "to_ids": true, "object_relation": "sha1"}, {"timestamp": "1632572319", "comment": "", "category": "Payload delivery", "value": "074bcc51b77d8e35b96ed444dc479b2878bf61bf7b07e4d7bd4cf136cc3c0dce", "type": "sha256", "uuid": "e079ba3d-06e8-48cb-9485-fbe574ddd5f6", "to_ids": true, "object_relation": "sha256"}, {"timestamp": "1632572319", "comment": "", "category": "Payload delivery", "value": "mssetup.exe", "type": "filename", "uuid": "8addc4dc-277b-415b-9668-18793d916b9f", "to_ids": false, "object_relation": "filename"}]}, {"timestamp": "1632572436", "comment": "corrupts the MBR ; sectors overwritten by this component are the same as those overwritten by NotPetya", "meta-category": "file", "uuid": "0a6e462e-8195-4473-aa6d-3fc0d0328877", "sharing_group_id": "0", "template_uuid": "688c46fb-5edb-40a3-8273-1af7923e2215", "name": "file", "description": "File object describing a file with meta-information", "distribution": "5", "template_version": "24", "Attribute": [{"timestamp": "1632572387", "comment": "", "category": "Payload delivery", "value": "nti.exe", "type": "filename", "uuid": "b1ac0e03-17db-45fe-8140-597d0daa7fa9", "to_ids": false, "object_relation": "filename"}]}, {"timestamp": "1632572556", "comment": "setup.bat is the first component executed via group policy. Interestingly, it deletes a scheduled task called \u00e2\u20ac\u02dcAnalyzeAll\u00e2\u20ac\u2122 under the Windows Power Efficiency Diagnostics directory. At this time, we haven\u00e2\u20ac\u2122t been able to identify this task. This batch file is responsible for copying the initial components via a CAB file in a network share within the Iranian railways network. The CAB file is expanded and update.bat is executed with the parameters \u00e2\u20ac\u02dchackemall\u00e2\u20ac\u2122, relevant paths, and the Meteor wiper executable (env.exe).", "meta-category": "file", "uuid": "bfc2e92d-83ca-47b5-8e66-6e939e61884a", "sharing_group_id": "0", "template_uuid": "688c46fb-5edb-40a3-8273-1af7923e2215", "name": "file", "description": "File object describing a file with meta-information", "distribution": "5", "template_version": "24", "Attribute": [{"timestamp": "1632572556", "comment": "", "category": "Payload delivery", "value": "b21bde15f12e30f9b8c167716da2d3d46c33f71b", "type": "sha1", "uuid": "b823ec30-56ce-4c5f-bf75-178009d97871", "to_ids": true, "object_relation": "sha1"}, {"timestamp": "1632572556", "comment": "", "category": "Payload delivery", "value": "b75a962528123df9d773baa86215d9b9c6d0b85bf8364e4e553d7b64a4a9f532", "type": "sha256", "uuid": "60e49719-2335-4824-a3f1-3e1e9089f857", "to_ids": true, "object_relation": "sha256"}, {"timestamp": "1632572556", "comment": "", "category": "Payload delivery", "value": "setup.bat", "type": "filename", "uuid": "596e5f65-27c9-4e3b-8fbd-61f46d8a669d", "to_ids": false, "object_relation": "filename"}]}, {"timestamp": "1632572611", "comment": "envxp.bat appears to be a simpler alternative version of setup.bat. As the name suggests, perhaps it\u00e2\u20ac\u2122s intended for Windows XP.", "meta-category": "file", "uuid": "38a50eed-f1d5-48db-88c2-6631ebb2d009", "sharing_group_id": "0", "template_uuid": "688c46fb-5edb-40a3-8273-1af7923e2215", "name": "file", "description": "File object describing a file with meta-information", "distribution": "5", "template_version": "24", "Attribute": [{"timestamp": "1632572611", "comment": "", "category": "Payload delivery", "value": "1b90dafc4a34491f64e62d63c82f1b44ca138887", "type": "sha1", "uuid": "75c81510-12aa-4b6c-8bf8-07b0d204a4ab", "to_ids": true, "object_relation": "sha1"}, {"timestamp": "1632572612", "comment": "", "category": "Payload delivery", "value": "67920ff26a18308084679186e18dcaa5f8af997c7036ba43c2e8c69ce24b9a1a", "type": "sha256", "uuid": "90baf50e-eb43-4b8b-bbd6-08eb95dbd969", "to_ids": true, "object_relation": "sha256"}, {"timestamp": "1632572612", "comment": "", "category": "Payload delivery", "value": "envxp.bat", "type": "filename", "uuid": "b4f6a3ac-7695-4e73-9136-889a217c103b", "to_ids": false, "object_relation": "filename"}]}, {"timestamp": "1632572679", "comment": "update.bat is a well written batch script that takes care of placing the remaining files and directing the remainder of the execution flow by calling the successive batch scripts. It takes three arguments: the password for the rar archives, the working directory, and the location of the payload. If the first two parameters are empty, it\u00e2\u20ac\u2122ll exit smoothly. In the absence of a payload, the script attempts to run msapp.exe. That component is listed in the Padvish security writeup but the execution flow via setup.bat points to env.exe as the intended payload. ", "meta-category": "file", "uuid": "df69e8ef-1e90-4064-ae98-b9b42e14afc3", "sharing_group_id": "0", "template_uuid": "688c46fb-5edb-40a3-8273-1af7923e2215", "name": "file", "description": "File object describing a file with meta-information", "distribution": "5", "template_version": "24", "Attribute": [{"timestamp": "1632572679", "comment": "", "category": "Payload delivery", "value": "86194d936776050ca4d7f1236badc9df872122f6", "type": "sha1", "uuid": "bf17c576-6a70-41b4-906e-909da0685242", "to_ids": true, "object_relation": "sha1"}, {"timestamp": "1632572679", "comment": "", "category": "Payload delivery", "value": "571468214c11e5c76ae524b730b26b02872d8987cc67ce2d7faaabeceb1f5e52", "type": "sha256", "uuid": "0bf77390-b716-45c4-90fe-23b6ebfdea99", "to_ids": true, "object_relation": "sha256"}, {"timestamp": "1632572679", "comment": "", "category": "Payload delivery", "value": "update.bat", "type": "filename", "uuid": "65f2a318-c70c-46b0-8bea-c8605cdaba83", "to_ids": false, "object_relation": "filename"}]}, {"timestamp": "1632572801", "comment": "focuses on clearing obstacles and preparing the ground for subsequent elements with the use of PowerShell", "meta-category": "file", "uuid": "82970d03-86b1-4c33-bfe5-9c5f5448f5d2", "sharing_group_id": "0", "template_uuid": "688c46fb-5edb-40a3-8273-1af7923e2215", "name": "file", "description": "File object describing a file with meta-information", "distribution": "5", "template_version": "24", "Attribute": [{"timestamp": "1632572801", "comment": "", "category": "Payload delivery", "value": "40faadf37fc6bace3a304f572b1f2892e8147820", "type": "sha1", "uuid": "fcad7250-5909-496f-89a5-39f2d180473d", "to_ids": true, "object_relation": "sha1"}, {"timestamp": "1632572802", "comment": "", "category": "Payload delivery", "value": "342fb340dc518faa5811d2b9701f83a14d409310da32e0b8c451a85200e08832", "type": "sha256", "uuid": "b67bb79d-dd06-4983-bd75-3f90b9815ef5", "to_ids": true, "object_relation": "sha256"}, {"timestamp": "1632572802", "comment": "", "category": "Payload delivery", "value": "cache.bat", "type": "filename", "uuid": "516f1650-5b2a-4424-b59d-76fcc27aa879", "to_ids": false, "object_relation": "filename"}]}, {"timestamp": "1632572867", "comment": "rendering the machine unbootable and cleaning up event logs", "meta-category": "file", "uuid": "ec686a31-d292-4162-80fe-9cd8993701d0", "sharing_group_id": "0", "template_uuid": "688c46fb-5edb-40a3-8273-1af7923e2215", "name": "file", "description": "File object describing a file with meta-information", "distribution": "5", "template_version": "24", "Attribute": [{"timestamp": "1632572867", "comment": "", "category": "Payload delivery", "value": "db82ef80f28bdca0821a616a1ba8db1d79287a67", "type": "sha1", "uuid": "e7a8a709-6c59-4c4c-bba2-a4b15ec1168d", "to_ids": true, "object_relation": "sha1"}, {"timestamp": "1632572867", "comment": "", "category": "Payload delivery", "value": "e9b70bf93f1b396be02feb35af5445985e3429461b195de881e0483361e57049", "type": "sha256", "uuid": "e606ce16-3c8b-48d7-83ad-7c1e71ed2e80", "to_ids": true, "object_relation": "sha256"}, {"timestamp": "1632572867", "comment": "", "category": "Payload delivery", "value": "bcd.bat", "type": "filename", "uuid": "e12418f7-65b6-4cbb-958f-8b41835d2054", "to_ids": false, "object_relation": "filename"}]}, {"timestamp": "1632573035", "comment": "msrun.bat moves several components into place including a screen locker (mssetup.exe) and the encrypted configuration for the Meteor wiper (msconf.conf). The script also moves four additional files: mscap.bmp, mscap.jpg, mssetup.reg, msuser.reg.", "meta-category": "file", "uuid": "93552689-0120-408c-b9b7-f59b1d8fdda3", "sharing_group_id": "0", "template_uuid": "688c46fb-5edb-40a3-8273-1af7923e2215", "name": "file", "description": "File object describing a file with meta-information", "distribution": "5", "template_version": "24", "Attribute": [{"timestamp": "1632573035", "comment": "", "category": "Payload delivery", "value": "msrun.bat", "type": "filename", "uuid": "12123917-6666-409c-a25d-73bec37cb2f2", "to_ids": false, "object_relation": "filename"}, {"timestamp": "1632573036", "comment": "", "category": "Payload delivery", "value": "0f941dea21337420610164da04fa2c3c929b2685363e79e5b70818cd43b3aa13", "type": "sha256", "uuid": "2b83574a-25ba-4133-b588-c1a29d30defe", "to_ids": true, "object_relation": "sha256"}, {"timestamp": "1632573036", "comment": "", "category": "Payload delivery", "value": "b3f5cc0288dce893cb5b4716f30b535e862dd3e6", "type": "sha1", "uuid": "8a9123d3-9fe4-4504-969e-e1a7485aabf0", "to_ids": true, "object_relation": "sha1"}]}, {"timestamp": "1632573088", "comment": "encrypted configuration for the Meteor wiper", "meta-category": "file", "uuid": "f2be88e8-8b59-442c-9da0-13d29948e454", "sharing_group_id": "0", "template_uuid": "688c46fb-5edb-40a3-8273-1af7923e2215", "name": "file", "description": "File object describing a file with meta-information", "distribution": "5", "template_version": "24", "Attribute": [{"timestamp": "1632573088", "comment": "", "category": "Payload delivery", "value": "msconf.conf", "type": "filename", "uuid": "3484a671-1f50-493d-82cf-d4f2725d9514", "to_ids": false, "object_relation": "filename"}, {"timestamp": "1632573088", "comment": "", "category": "Payload delivery", "value": "68e95a3ccde3ea22b8eb8adcf0ad53c7993b2ea5316948e31d9eadd11b5151d7", "type": "sha256", "uuid": "2e9b0dca-3a0a-421a-ae32-356530bd4ed5", "to_ids": true, "object_relation": "sha256"}, {"timestamp": "1632573089", "comment": "", "category": "Payload delivery", "value": "8249491393ffe07ffb3f987e8199f889579d0826", "type": "sha1", "uuid": "71d2ebd1-d05b-4e3f-bf0b-e27f5adcff4b", "to_ids": true, "object_relation": "sha1"}]}, {"timestamp": "1632573155", "comment": "", "meta-category": "file", "uuid": "f04f7424-fd2f-4187-8e36-71ede0babf75", "sharing_group_id": "0", "template_uuid": "688c46fb-5edb-40a3-8273-1af7923e2215", "name": "file", "description": "File object describing a file with meta-information", "distribution": "5", "template_version": "24", "Attribute": [{"timestamp": "1632573155", "comment": "", "category": "Payload delivery", "value": "mscap.bmp", "type": "filename", "uuid": "efa4e763-f58e-4f57-ad99-e1a856d21c68", "to_ids": false, "object_relation": "filename"}, {"timestamp": "1632573155", "comment": "", "category": "Payload delivery", "value": "3099deb8c06fb8d188863f0c861de0c5bef657abdb9920ab501d9e165e495381", "type": "sha256", "uuid": "de55fbb8-c65f-41ff-8372-da89071ffdd9", "to_ids": true, "object_relation": "sha256"}, {"timestamp": "1632573155", "comment": "", "category": "Payload delivery", "value": "03e6a0b9afe4346ff0e5bc2c3a4ff05e6a4eb6bd", "type": "sha1", "uuid": "8e66a4b5-e6cc-4e17-b66f-36cf147cc642", "to_ids": true, "object_relation": "sha1"}]}, {"timestamp": "1632573176", "comment": "", "meta-category": "file", "uuid": "fc1d916d-db94-4daa-8f85-c4411ecebece", "sharing_group_id": "0", "template_uuid": "688c46fb-5edb-40a3-8273-1af7923e2215", "name": "file", "description": "File object describing a file with meta-information", "distribution": "5", "template_version": "24", "Attribute": [{"timestamp": "1632573176", "comment": "", "category": "Payload delivery", "value": "mscap.jpg", "type": "filename", "uuid": "8a89bb56-1363-4320-a72d-41f72173913f", "to_ids": false, "object_relation": "filename"}, {"timestamp": "1632573177", "comment": "", "category": "Payload delivery", "value": "341e5d7fab4e6b5a16ab2c5b506d00e49b1b3aa214fb930a371637a1813382c6", "type": "sha256", "uuid": "4cbd3758-ccd8-4834-8519-4b69d6420e03", "to_ids": true, "object_relation": "sha256"}, {"timestamp": "1632573177", "comment": "", "category": "Payload delivery", "value": "03e6a0b9afe4346ff0e5bc2c3a4ff05e6a4eb6bd", "type": "sha1", "uuid": "ca1b10be-75fe-4411-a961-b7a397a4ce06", "to_ids": true, "object_relation": "sha1"}]}]}}